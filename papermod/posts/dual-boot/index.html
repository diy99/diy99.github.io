<!DOCTYPE html>
<html lang="zh-tw" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Windows 與 Arch Linux 雙系統 | DIY 99</title>
<meta name="keywords" content="">
<meta name="description" content="因作者的電腦 HDMI 電視時，Windows 顯示卡驅動程式卻無法取得最佳更新。Arch Linux 顯示卡驅動程式讓作者驚艷，大嘆好美的畫質！於是安裝雙系統。 建">
<meta name="author" content="
📝&nbsp;Jang">
<link rel="canonical" href="https://diy99.github.io/papermod/posts/dual-boot/">
<link crossorigin="anonymous" href="/papermod/assets/css/stylesheet.3c60e760117cf9a58814f8b11b3a6eaab6e30a69288e84083ebdc2422084f9e4.css" integrity="sha256-PGDnYBF8&#43;aWIFPixGzpuqrbjCmkojoQIPr3CQiCE&#43;eQ=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/papermod/assets/js/highlight.acb54fd32bbc1982428b8850317e45d076b95012730a5936667e6bc21777692a.js" integrity="sha256-rLVP0yu8GYJCi4hQMX5F0Ha5UBJzClk2Zn5rwhd3aSo="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://diy99.github.io/papermod/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://diy99.github.io/papermod/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://diy99.github.io/papermod/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://diy99.github.io/papermod/apple-touch-icon.png">
<link rel="mask-icon" href="https://diy99.github.io/papermod/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><link href="https://fonts.googleapis.com/css2?family=Oswald&family=Noto+Sans+TC&family=Noto+Sans+SC&family=Noto+Serif+TC:wght@500;700&family=Noto+Serif+SC:wght@500;700&family=Source+Code+Pro:ital,wght@0,400;0,700;1,400;1,700&display=swap" rel="stylesheet"><meta property="og:title" content="Windows 與 Arch Linux 雙系統" />
<meta property="og:description" content="因作者的電腦 HDMI 電視時，Windows 顯示卡驅動程式卻無法取得最佳更新。Arch Linux 顯示卡驅動程式讓作者驚艷，大嘆好美的畫質！於是安裝雙系統。 建" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://diy99.github.io/papermod/posts/dual-boot/" /><meta property="og:image" content="https://diy99.github.io/papermod/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-01-11T17:48:01+08:00" />
<meta property="article:modified_time" content="2023-01-11T17:48:01+08:00" /><meta property="og:site_name" content="DIY 99" />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://diy99.github.io/papermod/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"/>

<meta name="twitter:title" content="Windows 與 Arch Linux 雙系統"/>
<meta name="twitter:description" content="因作者的電腦 HDMI 電視時，Windows 顯示卡驅動程式卻無法取得最佳更新。Arch Linux 顯示卡驅動程式讓作者驚艷，大嘆好美的畫質！於是安裝雙系統。 建"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "文章",
      "item": "https://diy99.github.io/papermod/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Windows 與 Arch Linux 雙系統",
      "item": "https://diy99.github.io/papermod/posts/dual-boot/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Windows 與 Arch Linux 雙系統",
  "name": "Windows 與 Arch Linux 雙系統",
  "description": "因作者的電腦 HDMI 電視時，Windows 顯示卡驅動程式卻無法取得最佳更新。Arch Linux 顯示卡驅動程式讓作者驚艷，大嘆好美的畫質！於是安裝雙系統。 建",
  "keywords": [
    
  ],
  "articleBody": "因作者的電腦 HDMI 電視時，Windows 顯示卡驅動程式卻無法取得最佳更新。Arch Linux 顯示卡驅動程式讓作者驚艷，大嘆好美的畫質！於是安裝雙系統。\n建議先參閱 Dual boot with Windows，底下以 UEFI 模式，先 Windows 後 Arch Linux 為例。\n前置作業 Windows 在 UEFI 上的限制 Arch Linux 的安裝尚不支持 Secure Boot(安全開機)，要停用 Windows 控制台的電源選項停用 快速啟動(Fast Startup)與休眠(hibernation)\n硬碟磁區調整 安裝 Windows UEFI systems 後有四個分區，EFI 系統磁碟分區 (ESP) 內定約 100M，但 Arch Linux 的 EFI 至少須 300M，建議 550M以上，使用 MiniTool Partition 處理(EFI 之後的 MSR分區被隱藏保護)。下圖是作者增加 D槽，並挪出空間 80.54GB 安裝 Arch Linux。 如果你的 Windows 系統如下，第2分區就是 MSR(不可調整大小) 基礎安裝 以常見的 Windows UEFI systems 為例 參閱 Backup and Restore Boot Configuration Data (BCD) Store in Window 備份 Boot Configuration Data\nbcdedit /export \"\\.bcd\" 使用 DiskGenius 備份 EFI 分區，以便日後輕鬆還原 Windows 開機。 USB安裝碟開機(可參閱設置電腦用USB裝置開機)到 live environment cfdisk /dev/sda 增加分區 修改 Arch Linux Base Install - 基礎安裝 的 install.txt，第 127行 至 130行 成為\n#mkfs.fat -F32 /dev/sda1 mkfs.ext4 -F /dev/sda5 mount /dev/sda5 /mnt mount --mkdir /dev/sda2 /mnt/boot 新的 install.txt 如下\n#!/bin/bash #------------------------------------------------------------------------------- #Created by helmuthdu mailto: helmuthdu[at]gmail[dot]com #------------------------------------------------------------------------------- #This program is free software: you can redistribute it and/or modify #it under the terms of the GNU General Public License. #------------------------------------------------------------------------------- # Modified for ArchBang by Mr Green mrgreen(at)archbang(dot)org # Modified by chuanjang(at)gmail(dot)com #Usage: #pacman -Sy wget #wget https://diii.neocities.org/install.txt #nano install.txt OR vim install.txt #sh install.txt # COLORS Bold=$(tput bold) Underline=$(tput sgr 0 1) Reset=$(tput sgr0) # Regular Colors Red=$(tput setaf 1) Green=$(tput setaf 2) Yellow=$(tput setaf 3) Blue=$(tput setaf 4) Purple=$(tput setaf 5) Cyan=$(tput setaf 6) White=$(tput setaf 7) # Bold BRed=${Bold}$(tput setaf 1) BGreen=${Bold}$(tput setaf 2) BYellow=${Bold}$(tput setaf 3) BBlue=${Bold}$(tput setaf 4) BPurple=${Bold}$(tput setaf 5) BCyan=${Bold}$(tput setaf 6) BWhite=${Bold}$(tput setaf 7) arch_chroot() { #{{{ arch-chroot /mnt /bin/bash -c \"${1}\" } #}}} check_root() { #{{{ if [[ \"$(id -u)\" != \"0\" ]]; then error_msg \"ERROR! You must execute the script as the 'root' user.\" fi } #}}} print_line() { #{{{ printf \"%$(tput cols)s\\n\"|tr ' ' '-' } #}}} print_title() { #{{{ clear print_line echo -e \"# ${Bold}$1${Reset}\" print_line echo \"\" } #}}} read_input_text() { #{{{ read -p \"$1 [y/N]: \" OPTION OPTION=`echo \"$OPTION\" | tr '[:upper:]' '[:lower:]'` } #}}} pause_function() { #{{{ print_line read -e -sn 1 -p \"Press enter to continue...\" } #}}} print_warning() { #{{{ T_COLS=`tput cols` echo -e \"${BYellow}$1${Reset}\\n\" | fold -sw $(( $T_COLS - 1 )) } #}}} error_msg() { #{{{ local _msg=\"${1}\" echo -e \"${_msg}\" exit 1 } #}}} create_new_user(){ #{{{ print_title \"CREATE USER HAVE $(tput setaf 2)SUDO $(tput sgr0)$(tput bold)PRIVILEGES\" while [[ -z \"$username\" ]]; do read -p \"username: \" username username=`echo $username | tr '[:upper:]' '[:lower:]'` if [ -z \"$username\" ] ; then print_warning \"username empty, don't create user.\\n\" fi done arch_chroot \"useradd -m -g users -G wheel -s /bin/bash ${username}\" #arch_chroot \"chfn ${username}\" arch_chroot \"passwd ${username}\" while [[ $? -ne 0 ]]; do arch_chroot \"passwd ${username}\" done #arch_chroot \"visudo\" arch_chroot \"chmod 777 /etc/sudoers\" arch_chroot \"echo '%wheel ALL=(ALL:ALL) ALL' \u003e\u003e /etc/sudoers\" arch_chroot \"chmod 440 /etc/sudoers\" } #}}} # Verify the boot mode if [[ -d \"/sys/firmware/efi/\" ]]; then echo -e \"${Cyan}UEFI${Reset} Mode detected\\n\" UEFI=true else echo -e \"${Cyan}BIOS Mode${Reset} detected\\n\" UEFI=false fi pause_function # Connect to the internet ip link # Verify connection ping -c 1 archlinux.org echo -e \"\\n${Cyan}Connection${Reset} verified\" read_input_text \"Continue or not\" if [[ $OPTION != y ]]; then echo -e \"\\n\\nExit\" exit 0 fi # Ensure the system clock is accurate: #timedatectl # Partition the disks. To identify these devices, use lsblk #fdisk /dev/sda if $UEFI ; then echo -e \"\\n${Purple}UEFI${Reset}. Format and mount\\n\" #mkfs.fat -F32 /dev/sda1 mkfs.ext4 -F /dev/sda5 mount /dev/sda5 /mnt mount --mkdir /dev/sda2 /mnt/boot else echo -e \"\\n${Purple}BIOS${Reset}. Format and mount\\n\" BOOT_MNT=\"/dev/sda\" mkfs.ext4 -F /dev/sda1 mount /dev/sda1 /mnt fi # Select the mirrors - https://archlinux.org/mirrors/status/ echo -e \"\\n\\n\" PS3=\"Select ${Purple}mirror region${Reset}: \" items=(\"China\" \"Taiwan\") select item in \"${items[@]}\" do case $REPLY in 1) reflector --verbose --latest 10 --sort rate --country china --save /etc/pacman.d/mirrorlist break ;; 2) reflector --verbose --latest 10 --sort rate --country taiwan --save /etc/pacman.d/mirrorlist break ;; #$((${#items[@]}+1))) echo -e \"\\n${Red}Cancel${Reset}\"; break;; *) echo -e \"Invalid option ${Red}$REPLY${Reset}\";; esac done # Install essential packages and ... pacstrap /mnt base linux linux-firmware sudo networkmanager wget nano vim dhcpcd # Configure the system genfstab -U /mnt \u003e\u003e /mnt/etc/fstab echo -e \"\\n\\nChange root into the new system and ...\" pause_function #Set the time zone #arch_chroot \"ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime\" #arch_chroot \"ln -sf /usr/share/zoneinfo/Asia/Taipei /etc/localtime\" #Assumes the hardware clock is set to localtime #arch_chroot \"hwclock --systohc --localtime\" #Set language U.S. English arch_chroot \"sed -i '/#en_US.UTF-8/{s/#//}' /etc/locale.gen\" arch_chroot \"locale-gen\" arch_chroot \"echo 'LANG=en_US.UTF-8' \u003e /etc/locale.conf\" #Create the hostname file arch_chroot \"echo archlinux \u003e /etc/hostname\" # Configure mkinitcpio arch_chroot \"mkinitcpio -p linux\" echo -e \"\\nSet the root password\" arch_chroot \"passwd\" # Enable NetworkManager arch_chroot \"systemctl enable NetworkManager\" # Enable network connect echo -e \"\\nEnable Ethernet plug in the cable\\n\" arch_chroot \"systemctl enable dhcpcd\" create_new_user # Install Grub read_input_text \"Install GRUB boot loader:\" if [[ $OPTION != y ]]; then #arch-chroot /mnt echo -e \"\\n\\n${Red}Must${Reset} install boot loader.\\n\" exit 0 fi # Microcode must be loaded by the boot loader, Intel processors or AMD processors arch_chroot \"pacman -S intel-ucode amd-ucode --noconfirm\" arch_chroot \"pacman -S grub os-prober efibootmgr --noconfirm\" if $UEFI ; then arch_chroot \"grub-install --target=x86_64-efi --efi-directory=/boot --bootloader-id=GRUB\" else arch_chroot \"grub-install --target=i386-pc ${BOOT_MNT}\" fi arch_chroot \"grub-mkconfig -o /boot/grub/grub.cfg\" # Installation finished read_input_text \"Installation finished. Reboot system\" if [[ $OPTION != y ]]; then arch-chroot /mnt exit 0 fi umount -R /mnt reboot exit 0 sh install.txt。完成後，重新開機。\n安裝桌面 上一個步驟，GRUB 開機選單並未加入 Windows系統，安裝桌面後再處理是聰明選擇。 LXQt 桌面 Xfce 桌面 KDE 桌面\nGRUB 開機選單加入 Windows系統 使用兩顆硬碟分別安裝 Windows 與 Arch Linux 時，底下操作也適用。 先建立 ~/tmp，掛載 ESP\nmkdir ~/tmp sudo mount /dev/sda2 ~/tmp 有兩種方法加入 Windows開機： 方法一：偵測其他作業系統 編輯 /etc/default/grub (sudo l3afpad /etc/default/grub) 並取消下面這一行的注釋，或在文件最後增加\nGRUB_DISABLE_OS_PROBER=false 再執行\nsudo grub-mkconfig -o /boot/grub/grub.cfg 查看 /boot/grub/grub.cfg (sudo l3afpad /boot/grub/grub.cfg)，可得到下面這一行\nmenuentry 'Windows Boot Manager (on /dev/sda2)' 方法二： 參閱 UEFI/GPT 模式下安裝的 Windows 編輯\nif [ \"${grub_platform}\" == \"efi\" ]; then menuentry \"Microsoft Windows Vista/7/8/8.1 UEFI/GPT\" { insmod part_gpt insmod fat insmod chain search --no-floppy --fs-uuid --set=root $hints_string $fs_uuid chainloader /EFI/Microsoft/Boot/bootmgfw.efi } fi 其中 $hints_string 和 $fs_uuid 由下述兩個命令得到\nsudo grub-probe --target=fs_uuid ~/tmp/EFI/Microsoft/Boot/bootmgfw.efi 1AF6-3340 sudo grub-probe --target=hints_string ~/tmp/EFI/Microsoft/Boot/bootmgfw.efi --hint-bios=hd0,gpt2 --hint-efi=hd0,gpt2 --hint-baremetal=ahci0,gpt2 因此編輯成\nif [ \"${grub_platform}\" == \"efi\" ]; then menuentry \"Microsoft Windows 10 UEFI/GPT\" { insmod part_gpt insmod fat insmod chain search --no-floppy --fs-uuid --set=root --hint-bios=hd0,gpt2 --hint-efi=hd0,gpt2 --hint-baremetal=ahci0,gpt2 1AF6-3340 chainloader /EFI/Microsoft/Boot/bootmgfw.efi } fi 再將上面代碼貼至 /boot/grub/grub.cfg (sudo l3afpad /boot/grub/grub.cfg) 如果於### BEGIN /etc/grub.d/10_linux ###之前加入，則開機順序 Windows 優先 如果於submenu 'Advanced之前加入，則開機順序 Arch Linux 優先 重新開機至 Windows 參閱 Backup and Restore Boot Configuration Data (BCD) Store in Window 備份 Boot Configuration Data，使用 DiskGenius 備份 EFI 分區，以便輕鬆還原 Windows 與 Arch Linux 雙系統開機。 可使用本篇 基礎安裝 備份的 Boot Configuration Data 及 EFI 分區，還原純 Windows 系統開機。\n系統時間 參閱 Arch Linux基礎安裝重新開機與系統時間，設置 Arch Linux 系統時間與 Windows 系統時間\n存取 Windows NTFS 雖然安裝桌面可使用檔案管理員(如 pcmanfm-qt)掛載 NTFS，但功能上似稍嫌不足，安裝 NTFS-3G 較優\n",
  "wordCount" : "1776",
  "inLanguage": "zh-tw",
  "datePublished": "2023-01-11T17:48:01+08:00",
  "dateModified": "2023-01-11T17:48:01+08:00",
  "author":[{
    "@type": "Person",
    "name": "Jang"
  }],
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://diy99.github.io/papermod/posts/dual-boot/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "DIY 99",
    "logo": {
      "@type": "ImageObject",
      "url": "https://diy99.github.io/papermod/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://diy99.github.io/papermod/" accesskey="h" title="DIY99🏡 (Alt + H)">DIY99🏡</a>
            <div class="logo-switches">
				<button id="theme-toggle" accesskey="t" title="(Alt + T)">
				    <span id="moon">🌙</span>
					<span id="sun">🌞</span>
				</button>
				
				
				
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://diy99.github.io/papermod/archives/" title="歸檔">
                    <span><i class="fa-solid fa-boxes-packing"></i>歸檔</span>
                </a>
            </li>
            <li>
                <a href="https://diy99.github.io/papermod/categories/" title="分類">
                    <span><i class="fa-solid fa-shuffle"></i>分類</span>
                </a>
            </li>
            <li>
                <a href="https://diy99.github.io/papermod/tags/" title="標籤">
                    <span><i class="fa-solid fa-tags"></i>標籤</span>
                </a>
            </li>
            <li>
                <a href="https://diy99.github.io/papermod/about/" title="關於">
                    <span><i class="fa-solid fa-address-card"></i>關於</span>
                </a>
            </li>
            <li>
                <a href="https://diy99.github.io/papermod/search/" title="搜尋 (Alt &#43; /)" accesskey=/>
                    <span><i class="fa-brands fa-searchengin"></i>搜尋</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title">
      Windows 與 Arch Linux 雙系統
    </h1>
    <div class="post-meta">📅&nbsp;<span title='2023-01-11 17:48:01 +0800 CST'>2023-01-11</span>&nbsp;·&nbsp;⏱️&nbsp;4 分鐘&nbsp;·&nbsp;📃&nbsp;1776 字&nbsp;·&nbsp;
📝&nbsp;Jang

</div>
  </header> <div class="toc">
    <details  open>
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">文章目錄</span>
        </summary>

        <div class="inner"><nav id="TableOfContents">
  <ul>
    <li><a href="#前置作業">前置作業</a>
      <ul>
        <li><a href="#windows-在-uefi-上的限制">Windows 在 UEFI 上的限制</a></li>
        <li><a href="#硬碟磁區調整">硬碟磁區調整</a></li>
      </ul>
    </li>
    <li><a href="#基礎安裝">基礎安裝</a></li>
    <li><a href="#安裝桌面">安裝桌面</a></li>
    <li><a href="#grub-開機選單加入-windows系統">GRUB 開機選單加入 Windows系統</a></li>
    <li><a href="#系統時間">系統時間</a></li>
    <li><a href="#存取-windows-ntfs">存取 Windows NTFS</a></li>
  </ul>
</nav>
        </div>
    </details>
</div>

  <div class="post-content"><p>因作者的電腦 HDMI 電視時，Windows 顯示卡驅動程式卻無法取得最佳更新。Arch Linux 顯示卡驅動程式讓作者驚艷，大嘆好美的畫質！於是安裝雙系統。</p>
<p>建議先參閱 <a href="https://wiki.archlinux.org/title/Dual_boot_with_Windows">Dual boot with Windows</a>，底下以 UEFI 模式，先 Windows 後 Arch Linux 為例。</p>
<h2 id="前置作業">前置作業<a hidden class="anchor" aria-hidden="true" href="#前置作業">#</a></h2>
<h3 id="windows-在-uefi-上的限制">Windows 在 UEFI 上的限制<a hidden class="anchor" aria-hidden="true" href="#windows-在-uefi-上的限制">#</a></h3>
<p><i class="fa-brands fa-canadian-maple-leaf" style="color:#008000;"></i> Arch Linux 的安裝尚不支持 <a href="https://wiki.archlinuxcn.org/wiki/Arch_%2B_Windows_%E5%8F%8C%E7%B3%BB%E7%BB%9F#UEFI_%E5%AE%89%E5%85%A8%E5%90%AF%E5%8A%A8">Secure Boot</a>(<a href="https://support.microsoft.com/zh-tw/windows/%E5%9C%A8-windows-%E4%B8%AD%E4%BB%A5%E5%AE%89%E5%85%A8%E6%A8%A1%E5%BC%8F%E5%95%9F%E5%8B%95%E9%9B%BB%E8%85%A6-92c27cff-db89-8644-1ce4-b3e5e56fe234">安全開機</a>)，要<a href="https://learn.microsoft.com/zh-tw/windows-hardware/manufacture/desktop/disabling-secure-boot?view=windows-11&amp;preserve-view=true">停用</a>
<br><i class="fa-brands fa-canadian-maple-leaf" style="color:#008000;"></i> Windows 控制台的電源選項停用 <a href="https://wiki.archlinux.org/title/Dual_boot_with_Windows#Windows_settings">快速啟動(Fast Startup)與休眠(hibernation)</a></p>
<h3 id="硬碟磁區調整">硬碟磁區調整<a hidden class="anchor" aria-hidden="true" href="#硬碟磁區調整">#</a></h3>
<p><i class="fa-brands fa-canadian-maple-leaf" style="color:#008000;"></i> 安裝 <a href="https://wiki.archlinuxcn.org/wiki/Arch_%2B_Windows_%E5%8F%8C%E7%B3%BB%E7%BB%9F#UEFI_%E7%B3%BB%E7%BB%9F">Windows UEFI systems</a> 後有四個分區，EFI 系統磁碟分區 (ESP) 內定約 100M，但 Arch Linux 的 <a href="https://wiki.archlinux.org/title/installation_guide#Example_layouts">EFI</a> 至少須 <span style="color:#FF0000;">300M</span>，建議 550M以上，使用 <a href="/papermod/posts/disk-partition/#minitool-partition-wizard-free">MiniTool Partition</a> 處理(EFI 之後的 <a href="https://learn.microsoft.com/zh-tw/windows-hardware/manufacture/desktop/configure-uefigpt-based-hard-drive-partitions?view=windows-11#microsoft-reserved-partition-msr">MSR分區</a>被<span style="color:#FF0000;">隱藏保護</span>)。下圖是作者增加 D槽，並挪出空間 80.54GB 安裝 Arch Linux。
<img loading="lazy" src="https://diii.neocities.org/img/uefi0.webp#center" alt=""  />

<i class="fa-regular fa-bookmark" style="color:#D2691E;"></i> 如果你的 Windows 系統如下，第2分區就是 MSR(不可調整大小)
<img loading="lazy" src="https://diii.neocities.org/img/uefi1.webp#center" alt=""  />
</p>
<h2 id="基礎安裝">基礎安裝<a hidden class="anchor" aria-hidden="true" href="#基礎安裝">#</a></h2>
<p><i class="fa-brands fa-canadian-maple-leaf" style="color:#008000;"></i> 以常見的 <a href="https://wiki.archlinuxcn.org/wiki/Arch_%2B_Windows_%E5%8F%8C%E7%B3%BB%E7%BB%9F#UEFI_%E7%B3%BB%E7%BB%9F">Windows UEFI systems</a> 為例
<br><i class="fa-solid fa-bullhorn" style="color:#e55;"></i> 參閱 <a href="https://www.tenforums.com/tutorials/163900-backup-restore-boot-configuration-data-bcd-store-windows.html">Backup and Restore Boot Configuration Data (BCD) Store in Window</a> 備份 Boot Configuration Data</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">bcdedit /export &#34;&lt;full path&gt;\&lt;file name&gt;.bcd&#34;
</span></span></code></pre></div><p><i class="fa-solid fa-bullhorn" style="color:#e55;"></i> 使用 <a href="/papermod/posts/disk-partition/#diskgenius">DiskGenius</a> 備份 EFI 分區，以便日後輕鬆還原 Windows 開機。
<br><i class="fa-regular fa-bookmark" style="color:#D2691E;"></i> USB安裝碟開機(可參閱<a href="https://recoverit.wondershare.com/tw/windows-pe/how-to-set-computer-to-boot-from-cd-rom.html">設置電腦用USB裝置開機</a>)到 <a href="https://wiki.archlinux.org/title/installation_guide#Boot_the_live_environment">live environment</a>
<br><i class="fa-regular fa-bookmark" style="color:#D2691E;"></i> cfdisk /dev/sda 增加分區
<img loading="lazy" src="https://diii.neocities.org/img/uefi3.webp#center" alt=""  />

<i class="fa-regular fa-bookmark" style="color:#D2691E;"></i> 修改 <a href="/papermod/posts/archlinux-base-install/">Arch Linux Base Install - 基礎安裝</a> 的 install.txt，第 127行 至 130行 成為</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">#mkfs.fat -F32 /dev/sda1
</span></span><span class="line"><span class="cl">mkfs.ext4 -F /dev/sda5
</span></span><span class="line"><span class="cl">mount /dev/sda5 /mnt
</span></span><span class="line"><span class="cl">mount --mkdir /dev/sda2 /mnt/boot
</span></span></code></pre></div><p>新的 install.txt 如下</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="cp">#!/bin/bash
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="c1">#-------------------------------------------------------------------------------</span>
</span></span><span class="line"><span class="cl"><span class="c1">#Created by helmuthdu mailto: helmuthdu[at]gmail[dot]com</span>
</span></span><span class="line"><span class="cl"><span class="c1">#-------------------------------------------------------------------------------</span>
</span></span><span class="line"><span class="cl"><span class="c1">#This program is free software: you can redistribute it and/or modify</span>
</span></span><span class="line"><span class="cl"><span class="c1">#it under the terms of the GNU General Public License.</span>
</span></span><span class="line"><span class="cl"><span class="c1">#-------------------------------------------------------------------------------</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Modified for ArchBang by Mr Green mrgreen(at)archbang(dot)org</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Modified by chuanjang(at)gmail(dot)com</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#Usage: </span>
</span></span><span class="line"><span class="cl"><span class="c1">#pacman -Sy wget</span>
</span></span><span class="line"><span class="cl"><span class="c1">#wget https://diii.neocities.org/install.txt</span>
</span></span><span class="line"><span class="cl"><span class="c1">#nano install.txt OR vim install.txt</span>
</span></span><span class="line"><span class="cl"><span class="c1">#sh install.txt</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1"># COLORS</span>
</span></span><span class="line"><span class="cl">  <span class="nv">Bold</span><span class="o">=</span><span class="k">$(</span>tput bold<span class="k">)</span>
</span></span><span class="line"><span class="cl">  <span class="nv">Underline</span><span class="o">=</span><span class="k">$(</span>tput sgr <span class="m">0</span> 1<span class="k">)</span>
</span></span><span class="line"><span class="cl">  <span class="nv">Reset</span><span class="o">=</span><span class="k">$(</span>tput sgr0<span class="k">)</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># Regular Colors</span>
</span></span><span class="line"><span class="cl">  <span class="nv">Red</span><span class="o">=</span><span class="k">$(</span>tput setaf 1<span class="k">)</span>
</span></span><span class="line"><span class="cl">  <span class="nv">Green</span><span class="o">=</span><span class="k">$(</span>tput setaf 2<span class="k">)</span>
</span></span><span class="line"><span class="cl">  <span class="nv">Yellow</span><span class="o">=</span><span class="k">$(</span>tput setaf 3<span class="k">)</span>
</span></span><span class="line"><span class="cl">  <span class="nv">Blue</span><span class="o">=</span><span class="k">$(</span>tput setaf 4<span class="k">)</span>
</span></span><span class="line"><span class="cl">  <span class="nv">Purple</span><span class="o">=</span><span class="k">$(</span>tput setaf 5<span class="k">)</span>
</span></span><span class="line"><span class="cl">  <span class="nv">Cyan</span><span class="o">=</span><span class="k">$(</span>tput setaf 6<span class="k">)</span>
</span></span><span class="line"><span class="cl">  <span class="nv">White</span><span class="o">=</span><span class="k">$(</span>tput setaf 7<span class="k">)</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># Bold</span>
</span></span><span class="line"><span class="cl">  <span class="nv">BRed</span><span class="o">=</span><span class="si">${</span><span class="nv">Bold</span><span class="si">}</span><span class="k">$(</span>tput setaf 1<span class="k">)</span>
</span></span><span class="line"><span class="cl">  <span class="nv">BGreen</span><span class="o">=</span><span class="si">${</span><span class="nv">Bold</span><span class="si">}</span><span class="k">$(</span>tput setaf 2<span class="k">)</span>
</span></span><span class="line"><span class="cl">  <span class="nv">BYellow</span><span class="o">=</span><span class="si">${</span><span class="nv">Bold</span><span class="si">}</span><span class="k">$(</span>tput setaf 3<span class="k">)</span>
</span></span><span class="line"><span class="cl">  <span class="nv">BBlue</span><span class="o">=</span><span class="si">${</span><span class="nv">Bold</span><span class="si">}</span><span class="k">$(</span>tput setaf 4<span class="k">)</span>
</span></span><span class="line"><span class="cl">  <span class="nv">BPurple</span><span class="o">=</span><span class="si">${</span><span class="nv">Bold</span><span class="si">}</span><span class="k">$(</span>tput setaf 5<span class="k">)</span>
</span></span><span class="line"><span class="cl">  <span class="nv">BCyan</span><span class="o">=</span><span class="si">${</span><span class="nv">Bold</span><span class="si">}</span><span class="k">$(</span>tput setaf 6<span class="k">)</span>
</span></span><span class="line"><span class="cl">  <span class="nv">BWhite</span><span class="o">=</span><span class="si">${</span><span class="nv">Bold</span><span class="si">}</span><span class="k">$(</span>tput setaf 7<span class="k">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  arch_chroot<span class="o">()</span> <span class="o">{</span> <span class="c1">#{{{</span>
</span></span><span class="line"><span class="cl">    arch-chroot /mnt /bin/bash -c <span class="s2">&#34;</span><span class="si">${</span><span class="nv">1</span><span class="si">}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl">  <span class="c1">#}}}</span>
</span></span><span class="line"><span class="cl">  check_root<span class="o">()</span> <span class="o">{</span> <span class="c1">#{{{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="o">[[</span> <span class="s2">&#34;</span><span class="k">$(</span>id -u<span class="k">)</span><span class="s2">&#34;</span> !<span class="o">=</span> <span class="s2">&#34;0&#34;</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">      error_msg <span class="s2">&#34;ERROR! You must execute the script as the &#39;root&#39; user.&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">fi</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span> <span class="c1">#}}}</span>
</span></span><span class="line"><span class="cl">  print_line<span class="o">()</span> <span class="o">{</span> <span class="c1">#{{{</span>
</span></span><span class="line"><span class="cl">    <span class="nb">printf</span> <span class="s2">&#34;%</span><span class="k">$(</span>tput cols<span class="k">)</span><span class="s2">s\n&#34;</span><span class="p">|</span>tr <span class="s1">&#39; &#39;</span> <span class="s1">&#39;-&#39;</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span> <span class="c1">#}}}</span>
</span></span><span class="line"><span class="cl">  print_title<span class="o">()</span> <span class="o">{</span> <span class="c1">#{{{</span>
</span></span><span class="line"><span class="cl">    clear
</span></span><span class="line"><span class="cl">    print_line
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> -e <span class="s2">&#34;# </span><span class="si">${</span><span class="nv">Bold</span><span class="si">}</span><span class="nv">$1</span><span class="si">${</span><span class="nv">Reset</span><span class="si">}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">    print_line
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> <span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span> <span class="c1">#}}}</span>
</span></span><span class="line"><span class="cl">  read_input_text<span class="o">()</span> <span class="o">{</span> <span class="c1">#{{{</span>
</span></span><span class="line"><span class="cl">   <span class="nb">read</span> -p <span class="s2">&#34;</span><span class="nv">$1</span><span class="s2"> [y/N]: &#34;</span> OPTION
</span></span><span class="line"><span class="cl">    <span class="nv">OPTION</span><span class="o">=</span><span class="sb">`</span><span class="nb">echo</span> <span class="s2">&#34;</span><span class="nv">$OPTION</span><span class="s2">&#34;</span> <span class="p">|</span> tr <span class="s1">&#39;[:upper:]&#39;</span> <span class="s1">&#39;[:lower:]&#39;</span><span class="sb">`</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span> <span class="c1">#}}}</span>
</span></span><span class="line"><span class="cl">  pause_function<span class="o">()</span> <span class="o">{</span> <span class="c1">#{{{</span>
</span></span><span class="line"><span class="cl">    print_line
</span></span><span class="line"><span class="cl">    <span class="nb">read</span> -e -sn <span class="m">1</span> -p <span class="s2">&#34;Press enter to continue...&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span> <span class="c1">#}}}</span>
</span></span><span class="line"><span class="cl">  print_warning<span class="o">()</span> <span class="o">{</span> <span class="c1">#{{{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">T_COLS</span><span class="o">=</span><span class="sb">`</span>tput cols<span class="sb">`</span>
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> -e <span class="s2">&#34;</span><span class="si">${</span><span class="nv">BYellow</span><span class="si">}</span><span class="nv">$1</span><span class="si">${</span><span class="nv">Reset</span><span class="si">}</span><span class="s2">\n&#34;</span> <span class="p">|</span> fold -sw <span class="k">$((</span> <span class="nv">$T_COLS</span> <span class="o">-</span> <span class="m">1</span> <span class="k">))</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span> <span class="c1">#}}}</span>
</span></span><span class="line"><span class="cl">  error_msg<span class="o">()</span> <span class="o">{</span> <span class="c1">#{{{</span>
</span></span><span class="line"><span class="cl">    <span class="nb">local</span> <span class="nv">_msg</span><span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">1</span><span class="si">}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> -e <span class="s2">&#34;</span><span class="si">${</span><span class="nv">_msg</span><span class="si">}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">exit</span> <span class="m">1</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span> <span class="c1">#}}}</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  create_new_user<span class="o">(){</span> <span class="c1">#{{{</span>
</span></span><span class="line"><span class="cl">    print_title <span class="s2">&#34;CREATE USER HAVE </span><span class="k">$(</span>tput setaf 2<span class="k">)</span><span class="s2">SUDO </span><span class="k">$(</span>tput sgr0<span class="k">)$(</span>tput bold<span class="k">)</span><span class="s2">PRIVILEGES&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">while</span> <span class="o">[[</span> -z <span class="s2">&#34;</span><span class="nv">$username</span><span class="s2">&#34;</span>  <span class="o">]]</span><span class="p">;</span> <span class="k">do</span>
</span></span><span class="line"><span class="cl">      <span class="nb">read</span> -p <span class="s2">&#34;username: &#34;</span> username
</span></span><span class="line"><span class="cl">      <span class="nv">username</span><span class="o">=</span><span class="sb">`</span><span class="nb">echo</span> <span class="nv">$username</span> <span class="p">|</span> tr <span class="s1">&#39;[:upper:]&#39;</span> <span class="s1">&#39;[:lower:]&#39;</span><span class="sb">`</span>
</span></span><span class="line"><span class="cl">	  <span class="k">if</span> <span class="o">[</span> -z <span class="s2">&#34;</span><span class="nv">$username</span><span class="s2">&#34;</span> <span class="o">]</span> <span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">        print_warning <span class="s2">&#34;username empty, don&#39;t create user.\n&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="k">fi</span>
</span></span><span class="line"><span class="cl">    <span class="k">done</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    arch_chroot <span class="s2">&#34;useradd -m -g users -G wheel -s /bin/bash </span><span class="si">${</span><span class="nv">username</span><span class="si">}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="c1">#arch_chroot &#34;chfn ${username}&#34;</span>
</span></span><span class="line"><span class="cl">	arch_chroot <span class="s2">&#34;passwd </span><span class="si">${</span><span class="nv">username</span><span class="si">}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="k">while</span> <span class="o">[[</span> <span class="nv">$?</span> -ne <span class="m">0</span> <span class="o">]]</span><span class="p">;</span> <span class="k">do</span>
</span></span><span class="line"><span class="cl">      arch_chroot <span class="s2">&#34;passwd </span><span class="si">${</span><span class="nv">username</span><span class="si">}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">done</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">    <span class="c1">#arch_chroot &#34;visudo&#34;</span>
</span></span><span class="line"><span class="cl">	arch_chroot <span class="s2">&#34;chmod 777 /etc/sudoers&#34;</span>
</span></span><span class="line"><span class="cl">	arch_chroot <span class="s2">&#34;echo &#39;%wheel ALL=(ALL:ALL) ALL&#39; &gt;&gt; /etc/sudoers&#34;</span>
</span></span><span class="line"><span class="cl">    arch_chroot <span class="s2">&#34;chmod 440 /etc/sudoers&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span> <span class="c1">#}}}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Verify the boot mode</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="o">[[</span> -d <span class="s2">&#34;/sys/firmware/efi/&#34;</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">  <span class="nb">echo</span> -e <span class="s2">&#34;</span><span class="si">${</span><span class="nv">Cyan</span><span class="si">}</span><span class="s2">UEFI</span><span class="si">${</span><span class="nv">Reset</span><span class="si">}</span><span class="s2"> Mode detected\n&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">UEFI</span><span class="o">=</span><span class="nb">true</span>
</span></span><span class="line"><span class="cl"><span class="k">else</span>
</span></span><span class="line"><span class="cl">  <span class="nb">echo</span> -e <span class="s2">&#34;</span><span class="si">${</span><span class="nv">Cyan</span><span class="si">}</span><span class="s2">BIOS Mode</span><span class="si">${</span><span class="nv">Reset</span><span class="si">}</span><span class="s2"> detected\n&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">UEFI</span><span class="o">=</span><span class="nb">false</span>
</span></span><span class="line"><span class="cl"><span class="k">fi</span>
</span></span><span class="line"><span class="cl">pause_function
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Connect to the internet</span>
</span></span><span class="line"><span class="cl">ip link
</span></span><span class="line"><span class="cl"><span class="c1"># Verify connection</span>
</span></span><span class="line"><span class="cl">ping -c <span class="m">1</span> archlinux.org
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> -e <span class="s2">&#34;\n</span><span class="si">${</span><span class="nv">Cyan</span><span class="si">}</span><span class="s2">Connection</span><span class="si">${</span><span class="nv">Reset</span><span class="si">}</span><span class="s2"> verified&#34;</span>
</span></span><span class="line"><span class="cl">read_input_text <span class="s2">&#34;Continue or not&#34;</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="o">[[</span> <span class="nv">$OPTION</span> !<span class="o">=</span> y <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">  <span class="nb">echo</span> -e <span class="s2">&#34;\n\nExit&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="nb">exit</span> <span class="m">0</span>
</span></span><span class="line"><span class="cl"><span class="k">fi</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Ensure the system clock is accurate:</span>
</span></span><span class="line"><span class="cl"><span class="c1">#timedatectl</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Partition the disks. To identify these devices, use lsblk </span>
</span></span><span class="line"><span class="cl"><span class="c1">#fdisk /dev/sda</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="nv">$UEFI</span> <span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> -e <span class="s2">&#34;\n</span><span class="si">${</span><span class="nv">Purple</span><span class="si">}</span><span class="s2">UEFI</span><span class="si">${</span><span class="nv">Reset</span><span class="si">}</span><span class="s2">. Format and mount\n&#34;</span>
</span></span><span class="line"><span class="cl"><span class="c1">#mkfs.fat -F32 /dev/sda1</span>
</span></span><span class="line"><span class="cl">mkfs.ext4 -F /dev/sda5
</span></span><span class="line"><span class="cl">mount /dev/sda5 /mnt
</span></span><span class="line"><span class="cl">mount --mkdir /dev/sda2 /mnt/boot
</span></span><span class="line"><span class="cl"><span class="k">else</span>
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> -e <span class="s2">&#34;\n</span><span class="si">${</span><span class="nv">Purple</span><span class="si">}</span><span class="s2">BIOS</span><span class="si">${</span><span class="nv">Reset</span><span class="si">}</span><span class="s2">. Format and mount\n&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">BOOT_MNT</span><span class="o">=</span><span class="s2">&#34;/dev/sda&#34;</span>
</span></span><span class="line"><span class="cl">mkfs.ext4 -F /dev/sda1
</span></span><span class="line"><span class="cl">mount /dev/sda1 /mnt 
</span></span><span class="line"><span class="cl"><span class="k">fi</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Select the mirrors - https://archlinux.org/mirrors/status/</span>
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> -e <span class="s2">&#34;\n\n&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">PS3</span><span class="o">=</span><span class="s2">&#34;Select </span><span class="si">${</span><span class="nv">Purple</span><span class="si">}</span><span class="s2">mirror region</span><span class="si">${</span><span class="nv">Reset</span><span class="si">}</span><span class="s2">: &#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">items</span><span class="o">=(</span><span class="s2">&#34;China&#34;</span> <span class="s2">&#34;Taiwan&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="k">select</span> item in <span class="s2">&#34;</span><span class="si">${</span><span class="nv">items</span><span class="p">[@]</span><span class="si">}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl"><span class="k">do</span>
</span></span><span class="line"><span class="cl">  <span class="k">case</span> <span class="nv">$REPLY</span> in
</span></span><span class="line"><span class="cl">      1<span class="o">)</span> reflector --verbose --latest <span class="m">10</span> --sort rate --country china --save /etc/pacman.d/mirrorlist
</span></span><span class="line"><span class="cl">		  <span class="nb">break</span>
</span></span><span class="line"><span class="cl">		<span class="p">;;</span>
</span></span><span class="line"><span class="cl">      2<span class="o">)</span> reflector --verbose --latest <span class="m">10</span> --sort rate --country taiwan --save /etc/pacman.d/mirrorlist
</span></span><span class="line"><span class="cl">		<span class="nb">break</span>
</span></span><span class="line"><span class="cl">		<span class="p">;;</span>
</span></span><span class="line"><span class="cl">      <span class="c1">#$((${#items[@]}+1))) echo  -e &#34;\n${Red}Cancel${Reset}&#34;; break;;</span>
</span></span><span class="line"><span class="cl">      *<span class="o">)</span> <span class="nb">echo</span> -e <span class="s2">&#34;Invalid option </span><span class="si">${</span><span class="nv">Red</span><span class="si">}</span><span class="nv">$REPLY</span><span class="si">${</span><span class="nv">Reset</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">;;</span>
</span></span><span class="line"><span class="cl">    <span class="k">esac</span>
</span></span><span class="line"><span class="cl"><span class="k">done</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Install essential packages and ...</span>
</span></span><span class="line"><span class="cl">pacstrap /mnt base linux linux-firmware sudo networkmanager wget nano vim dhcpcd
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Configure the system</span>
</span></span><span class="line"><span class="cl">genfstab -U /mnt &gt;&gt; /mnt/etc/fstab
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> -e <span class="s2">&#34;\n\nChange root into the new system and ...&#34;</span>
</span></span><span class="line"><span class="cl">pause_function
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#Set the time zone</span>
</span></span><span class="line"><span class="cl"><span class="c1">#arch_chroot &#34;ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime&#34;</span>
</span></span><span class="line"><span class="cl"><span class="c1">#arch_chroot &#34;ln -sf /usr/share/zoneinfo/Asia/Taipei /etc/localtime&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#Assumes the hardware clock is set to localtime</span>
</span></span><span class="line"><span class="cl"><span class="c1">#arch_chroot &#34;hwclock --systohc --localtime&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#Set language  U.S. English</span>
</span></span><span class="line"><span class="cl">arch_chroot <span class="s2">&#34;sed -i &#39;/#en_US.UTF-8/{s/#//}&#39; /etc/locale.gen&#34;</span>
</span></span><span class="line"><span class="cl">arch_chroot <span class="s2">&#34;locale-gen&#34;</span>
</span></span><span class="line"><span class="cl">arch_chroot <span class="s2">&#34;echo &#39;LANG=en_US.UTF-8&#39; &gt; /etc/locale.conf&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#Create the hostname file</span>
</span></span><span class="line"><span class="cl">arch_chroot <span class="s2">&#34;echo archlinux &gt; /etc/hostname&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Configure mkinitcpio</span>
</span></span><span class="line"><span class="cl">arch_chroot <span class="s2">&#34;mkinitcpio -p linux&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> -e <span class="s2">&#34;\nSet the root password&#34;</span>
</span></span><span class="line"><span class="cl">arch_chroot <span class="s2">&#34;passwd&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Enable NetworkManager</span>
</span></span><span class="line"><span class="cl">arch_chroot <span class="s2">&#34;systemctl enable NetworkManager&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Enable network connect </span>
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> -e <span class="s2">&#34;\nEnable Ethernet plug in the cable\n&#34;</span>
</span></span><span class="line"><span class="cl">arch_chroot <span class="s2">&#34;systemctl enable dhcpcd&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">create_new_user
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Install Grub</span>
</span></span><span class="line"><span class="cl">read_input_text <span class="s2">&#34;Install GRUB boot loader:&#34;</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="o">[[</span> <span class="nv">$OPTION</span> !<span class="o">=</span> y <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">  <span class="c1">#arch-chroot /mnt</span>
</span></span><span class="line"><span class="cl">  <span class="nb">echo</span> -e <span class="s2">&#34;\n\n</span><span class="si">${</span><span class="nv">Red</span><span class="si">}</span><span class="s2">Must</span><span class="si">${</span><span class="nv">Reset</span><span class="si">}</span><span class="s2"> install boot loader.\n&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="nb">exit</span> <span class="m">0</span>
</span></span><span class="line"><span class="cl"><span class="k">fi</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Microcode must be loaded by the boot loader, Intel processors or AMD processors</span>
</span></span><span class="line"><span class="cl">arch_chroot <span class="s2">&#34;pacman -S intel-ucode amd-ucode --noconfirm&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">arch_chroot <span class="s2">&#34;pacman -S grub os-prober efibootmgr  --noconfirm&#34;</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="nv">$UEFI</span> <span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">  arch_chroot <span class="s2">&#34;grub-install --target=x86_64-efi --efi-directory=/boot --bootloader-id=GRUB&#34;</span>
</span></span><span class="line"><span class="cl"><span class="k">else</span>
</span></span><span class="line"><span class="cl">  arch_chroot <span class="s2">&#34;grub-install --target=i386-pc </span><span class="si">${</span><span class="nv">BOOT_MNT</span><span class="si">}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl"><span class="k">fi</span>
</span></span><span class="line"><span class="cl">arch_chroot <span class="s2">&#34;grub-mkconfig -o /boot/grub/grub.cfg&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Installation finished</span>
</span></span><span class="line"><span class="cl">read_input_text <span class="s2">&#34;Installation finished. Reboot system&#34;</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="o">[[</span> <span class="nv">$OPTION</span> !<span class="o">=</span> y <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">  arch-chroot /mnt
</span></span><span class="line"><span class="cl">  <span class="nb">exit</span> <span class="m">0</span>
</span></span><span class="line"><span class="cl"><span class="k">fi</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">umount -R /mnt
</span></span><span class="line"><span class="cl">reboot
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">exit</span> <span class="m">0</span>
</span></span></code></pre></div><p><i class="fa-brands fa-canadian-maple-leaf" style="color:#008000;"></i> sh install.txt。完成後，重新開機。</p>
<h2 id="安裝桌面">安裝桌面<a hidden class="anchor" aria-hidden="true" href="#安裝桌面">#</a></h2>
<p>上一個步驟，GRUB 開機選單並未加入 <span style="color:#FF0000;">Windows系統</span>，安裝桌面後再處理是聰明選擇。
<br><i class="fa-brands fa-canadian-maple-leaf" style="color:#008000;"></i> <a href="/papermod/posts/lxqt/">LXQt</a> 桌面
<br><i class="fa-brands fa-canadian-maple-leaf" style="color:#008000;"></i> <a href="/papermod/posts/xfce/">Xfce</a> 桌面
<br><i class="fa-brands fa-canadian-maple-leaf" style="color:#008000;"></i> <a href="/papermod/posts/kde/">KDE</a> 桌面</p>
<h2 id="grub-開機選單加入-windows系統">GRUB 開機選單加入 Windows系統<a hidden class="anchor" aria-hidden="true" href="#grub-開機選單加入-windows系統">#</a></h2>
<p><i class="fa-solid fa-bullhorn" style="color:#e55;"></i> 使用兩顆硬碟分別安裝 Windows 與 Arch Linux 時，底下操作也適用。
<br><i class="fa-brands fa-canadian-maple-leaf" style="color:#008000;"></i> 先建立 ~/tmp，掛載 ESP</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">mkdir ~/tmp
</span></span><span class="line"><span class="cl">sudo mount /dev/sda2 ~/tmp
</span></span></code></pre></div><p>有兩種方法加入 Windows開機：
<br><i class="fa-brands fa-canadian-maple-leaf" style="color:#008000;"></i> <span style="color:#FF0000;">方法一</span>：<a href="https://wiki.archlinux.org/title/GRUB#Detecting_other_operating_systems">偵測其他作業系統</a>
<br>編輯 /etc/default/grub (<code>sudo l3afpad /etc/default/grub</code>) 並取消下面這一行的注釋，或在文件最後增加</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">GRUB_DISABLE_OS_PROBER=false
</span></span></code></pre></div><p>再執行</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">sudo grub-mkconfig -o /boot/grub/grub.cfg
</span></span></code></pre></div><p>查看 /boot/grub/grub.cfg (<code>sudo l3afpad /boot/grub/grub.cfg</code>)，可得到下面這一行</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">menuentry &#39;Windows Boot Manager (on /dev/sda2)&#39;
</span></span></code></pre></div><p><i class="fa-brands fa-canadian-maple-leaf" style="color:#008000;"></i> <span style="color:#FF0000;">方法二</span>：
<br>參閱 <a href="https://wiki.archlinuxcn.org/wiki/GRUB#UEFI/GPT_%E6%A8%A1%E5%BC%8F%E4%B8%8B%E5%AE%89%E8%A3%85%E7%9A%84_Windows">UEFI/GPT 模式下安裝的 Windows</a> 編輯</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">if [ &#34;${grub_platform}&#34; == &#34;efi&#34; ]; then
</span></span><span class="line"><span class="cl">	menuentry &#34;Microsoft Windows Vista/7/8/8.1 UEFI/GPT&#34; {
</span></span><span class="line"><span class="cl">		insmod part_gpt
</span></span><span class="line"><span class="cl">		insmod fat
</span></span><span class="line"><span class="cl">		insmod chain
</span></span><span class="line"><span class="cl">		search --no-floppy --fs-uuid --set=root $hints_string $fs_uuid
</span></span><span class="line"><span class="cl">		chainloader /EFI/Microsoft/Boot/bootmgfw.efi
</span></span><span class="line"><span class="cl">	}
</span></span><span class="line"><span class="cl">fi
</span></span></code></pre></div><p>其中 $hints_string 和 $fs_uuid 由下述兩個命令得到</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">sudo grub-probe --target=fs_uuid ~/tmp/EFI/Microsoft/Boot/bootmgfw.efi
</span></span><span class="line"><span class="cl">1AF6-3340
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">sudo grub-probe --target=hints_string ~/tmp/EFI/Microsoft/Boot/bootmgfw.efi
</span></span><span class="line"><span class="cl">--hint-bios=hd0,gpt2 --hint-efi=hd0,gpt2 --hint-baremetal=ahci0,gpt2
</span></span></code></pre></div><p>因此編輯成</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">if [ &#34;${grub_platform}&#34; == &#34;efi&#34; ]; then
</span></span><span class="line"><span class="cl">	menuentry &#34;Microsoft Windows 10 UEFI/GPT&#34; {
</span></span><span class="line"><span class="cl">		insmod part_gpt
</span></span><span class="line"><span class="cl">		insmod fat
</span></span><span class="line"><span class="cl">		insmod chain
</span></span><span class="line"><span class="cl">		search --no-floppy --fs-uuid --set=root --hint-bios=hd0,gpt2 --hint-efi=hd0,gpt2 --hint-baremetal=ahci0,gpt2 1AF6-3340
</span></span><span class="line"><span class="cl">		chainloader /EFI/Microsoft/Boot/bootmgfw.efi
</span></span><span class="line"><span class="cl">	}
</span></span><span class="line"><span class="cl">fi
</span></span></code></pre></div><p>再將上面代碼貼至 /boot/grub/grub.cfg (<code>sudo l3afpad /boot/grub/grub.cfg</code>)
<br><i class="fa-regular fa-bookmark" style="color:#D2691E;"></i> 如果於<code>### BEGIN /etc/grub.d/10_linux ###</code>之前加入，則開機順序 Windows 優先
<br><i class="fa-regular fa-bookmark" style="color:#D2691E;"></i> 如果於<code>submenu 'Advanced</code>之前加入，則開機順序 Arch Linux  優先
<br><i class="fa-brands fa-canadian-maple-leaf" style="color:#008000;"></i> 重新開機至 Windows
<br><i class="fa-solid fa-bullhorn" style="color:#e55;"></i> 參閱 <a href="https://www.tenforums.com/tutorials/163900-backup-restore-boot-configuration-data-bcd-store-windows.html">Backup and Restore Boot Configuration Data (BCD) Store in Window</a> 備份 Boot Configuration Data，使用 <a href="/papermod/posts/disk-partition/#diskgenius">DiskGenius</a> 備份 EFI 分區，以便輕鬆還原 Windows 與 Arch Linux 雙系統開機。
<br><i class="fa-solid fa-bullhorn" style="color:#e55;"></i> 可使用本篇 <a href="/papermod/posts/dual-boot/#%E5%9F%BA%E7%A4%8E%E5%AE%89%E8%A3%9D">基礎安裝</a> 備份的 Boot Configuration Data 及 EFI 分區，還原<span style="color:#FF0000;">純</span> Windows 系統開機。</p>
<h2 id="系統時間">系統時間<a hidden class="anchor" aria-hidden="true" href="#系統時間">#</a></h2>
<p>參閱 Arch Linux基礎安裝<a href="/papermod/posts/archlinux-base-install/#%E9%87%8D%E6%96%B0%E9%96%8B%E6%A9%9F%E8%88%87%E7%B3%BB%E7%B5%B1%E6%99%82%E9%96%93">重新開機與系統時間</a>，設置 Arch Linux 系統時間與 Windows 系統時間</p>
<h2 id="存取-windows-ntfs">存取 Windows NTFS<a hidden class="anchor" aria-hidden="true" href="#存取-windows-ntfs">#</a></h2>
<p>雖然安裝桌面可使用檔案管理員(如 pcmanfm-qt)掛載 NTFS，但功能上似稍嫌不足，安裝 <a href="https://wiki.archlinux.org/title/NTFS-3G">NTFS-3G</a> 較優</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
    </ul>
<nav class="paginav">
  <a class="prev" href="https://diy99.github.io/papermod/posts/disk-partition/">
    <span class="title">« 上一頁</span>
    <br>
    <span>硬碟分割與調整</span>
  </a>
  <a class="next" href="https://diy99.github.io/papermod/posts/audacious/">
    <span class="title">下一頁 »</span>
    <br>
    <span>Audacious 音樂播放</span>
  </a>
</nav>


<div style="font-size: 32px; font-weight: bold;">✏️留言板<sup><span data-cusdis-count-page-id="2840b1c52a650d4b2d7882d0b6982d6f"  style="font-size: 22px;color: #E95413;">0</span></sup> - Comments<sup><span data-cusdis-count-page-id="2840b1c52a650d4b2d7882d0b6982d6f"  style="font-size: 22px;color: #E95413;">0</span></sup></div>
<script defer data-host="https://cusdis.com" data-app-id="03b773f6-bc48-47d6-b4a5-3452554ff3d2" src="https://cusdis.com/js/cusdis-count.umd.js"></script>
<div id="cusdis_thread" style="background-color:lightblue;border-style: ridge;border-color: #D2691E;"
  data-host="https://cusdis.com"
  data-app-id="03b773f6-bc48-47d6-b4a5-3452554ff3d2"
  data-page-id="2840b1c52a650d4b2d7882d0b6982d6f"
  data-page-url="https://diy99.github.io/papermod/posts/dual-boot/"
  data-page-title="Windows 與 Arch Linux 雙系統"></div>
<script defer src="/papermod/js/zh-tw.js"></script>
<script defer src="https://cusdis.com/js/cusdis.es.js"></script>

  </footer>
</article>
    </main>
    <div style="text-align: center;">
    <div class="social-icons">
    <a href="mailto:simplelogin-newsletter.left483@simplelogin.com" target="_blank" rel="noopener noreferrer me" title="Email">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 21" fill="none" stroke="currentColor" stroke-width="2"
    stroke-linecap="round" stroke-linejoin="round">
    <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
    <polyline points="22,6 12,13 2,6"></polyline>
</svg>
    </a>
    <a href="https://github.com/diy99" target="_blank" rel="noopener noreferrer me" title="Github">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
    stroke-linecap="round" stroke-linejoin="round">
    <path
        d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22">
    </path>
</svg>
    </a>
</div>

</div>
<footer class="footer">
    <span class="copyright">非營利情況下都可以引用或轉載本站文章，不過請註明出處！😉</span><br>
    <span>&copy; 2024 <a href="https://diy99.github.io/papermod/">DIY 99</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
		
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = '複製';

        function copyingDone() {
            copybutton.innerHTML = '已複製！';
            setTimeout(() => {
                copybutton.innerHTML = '複製';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
